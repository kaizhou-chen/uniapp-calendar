import{r as e,d as a,o as t,c as l,w as s,a as u,b as n,t as o,e as c,f as d,F as r,g as v,i,h as f,u as h,n as _,j as m,k as p,l as y,S as g,m as w,p as x,q as $,$ as k,s as I}from"./index-CB-fBPLm.js";import{d as T,_ as M,u as S}from"./plugin-vueexport-helper.Cru2XiZ3.js";const C=M(a({__name:"Schedule",props:{activeItem:{}},setup(a,{expose:m}){const p=e(!1),y=()=>{p.value=!1};return m({show:()=>{p.value=!0},hide:y}),(e,a)=>{const m=i,g=f;return p.value?(t(),l(m,{key:0},{default:s((()=>[u(m,{class:"head"},{default:s((()=>[u(m,null,{default:s((()=>[n(o(e.activeItem?`${e.activeItem.year}年${e.activeItem.month}月${e.activeItem.day}日`:""),1)])),_:1}),u(m,{class:"icon",onClick:y},{default:s((()=>[u(g,{src:"/uniapp-calendar/static/down.png",class:"icon"})])),_:1})])),_:1}),u(m,{class:"wrap"},{default:s((()=>[(t(!0),c(r,null,d(e.activeItem.list,(e=>(t(),l(m,{key:e.id,onClick:a=>(e=>{_({url:`/pages/edit/edit?id=${e.id}`})})(e)},{default:s((()=>[u(m,{class:"item"},{default:s((()=>[u(m,{class:"time"},{default:s((()=>[u(m,null,{default:s((()=>[n(o(h(T)(e.begin).format("HH:mm")),1)])),_:2},1024),u(m,null,{default:s((()=>[n(o(h(T)(e.end).format("HH:mm")),1)])),_:2},1024)])),_:2},1024),u(m,{class:"type"}),u(m,{class:"content"},{default:s((()=>[u(m,{class:"title"},{default:s((()=>[n(o(e.title),1)])),_:2},1024),u(m,{class:"text"},{default:s((()=>[n(o(e.note),1)])),_:2},1024),u(m,{class:"text"},{default:s((()=>[n(o(e.location),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):v("",!0)}}}),[["__scopeId","data-v-b469e877"]]),b=M(a({__name:"Calendar",props:{year:{},month:{},isToday:{type:Boolean}},emits:["change"],setup(a,{expose:v,emit:f}){const h=f,{setActiveDate:_}=S(),$=e(["周一","周二","周三","周四","周五","周六","周日"]),k=e(),I=e(),M=e(),b=e(),D=e(),R=e(),H=e();function L(){k.value=T().year(),I.value=T().month()+1,M.value=Y();let e=T().date();b.value=T().format("YYYY-MM-DD"),D.value=M.value.find((a=>a.date===E(k.value,I.value,e))),_(D.value.date)}function Y(){const e=[];let a=I.value,t=k.value;const l=T(`${t}-${a}`),s=l.daysInMonth();for(let o=1;o<=s;o++)e.push({year:t,month:a,day:o,date:E(t,a,o)});const u=function(e){const a=[],t=e.startOf("month").day();if(1==t)return a;let l=I.value,s=k.value;l--,0==l&&(s--,l=12);const u=T(`${s}-${l}`).daysInMonth();for(let n=1;n<=t-1;n++){const e=u-(t-1-n);a.push({year:s,month:l,day:e,date:E(s,l,e),extra:!0})}return a}(l),n=function(e){const a=[],t=e.endOf("month").day(),l=0==t?7:t;let s=I.value,u=k.value;s++,s>12&&(u++,s=1);for(let n=1;n<=7-l;n++)a.push({year:u,month:s,day:n,date:E(u,s,n),extra:!0});return a}(l);return e.unshift(...u),e.push(...n),j(e),h("change",{year:k.value,month:I.value}),e}function j(e){e.forEach((e=>{const a=p(e.date);a&&(e.list=JSON.parse(a))}))}m((()=>{L()}));const E=(e,a,t)=>`${e}-${a<10?"0":""}${a}-${t<10?"0":""}${t}`;return v({showToday:L,gotoPrevMonth:()=>{I.value=I.value-1,I.value<1&&(k.value=k.value-1,I.value=12),M.value=Y()},gotoNextMonth:()=>{I.value=I.value+1,I.value>12&&(k.value=k.value+1,I.value=1),M.value=Y()},refreshList:()=>{if(M.value){const e=M.value;j(e),M.value=e}}}),(e,a)=>{const v=i,f=g;return t(),l(v,{class:"container",onTouchmove:a[0]||(a[0]=y((()=>{}),["stop"]))},{default:s((()=>[u(v,{class:"weeks"},{default:s((()=>[(t(!0),c(r,null,d($.value,(e=>(t(),l(v,{key:e,class:"week"},{default:s((()=>[n(o(e),1)])),_:2},1024)))),128))])),_:1}),u(f,{class:"days-scroll","scroll-y":"","scroll-into-view":H.value},{default:s((()=>[u(v,{class:"days"},{default:s((()=>[(t(!0),c(r,null,d(M.value,((e,a)=>{var i;return t(),l(v,{key:a+"pre",class:w([{today:e.date===b.value,active:e.date===(null==(i=D.value)?void 0:i.date)},"day"]),onClick:a=>(async(e,a)=>{D.value=a,_(D.value.date),!a.list||a.list.length<=0?R.value.hide():R.value.show(),await x(),H.value="date_"+a.date})(0,e)},{default:s((()=>[u(v,{id:"date_"+e.date},null,8,["id"]),u(v,{class:w(["text",{extra:e.extra}])},{default:s((()=>[n(o(e.day),1)])),_:2},1032,["class"]),u(v,{class:"schedule-wrap"},{default:s((()=>[(t(!0),c(r,null,d(e.list,(e=>(t(),l(v,{key:e.id,class:"schedule"},{default:s((()=>[u(v,{class:w([[e.type||"default"],"text"])},{default:s((()=>[n(o(e.title),1)])),_:2},1032,["class"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1032,["class","onClick"])})),128))])),_:1})])),_:1},8,["scroll-into-view"]),u(C,{ref_key:"scheduleRef",ref:R,activeItem:D.value},null,8,["activeItem"])])),_:1})}}}),[["__scopeId","data-v-4982202b"]]),D=M(a({__name:"index",setup(a){const n=e(),o=e(),c=e();$((async()=>{await x(),n.value.refreshList(),k("today",(()=>{n.value.showToday()}))}));const{touchStart:d,touchEnd:r}=(a=>{const t=e(),l=e(0),s=e(0);return{touchStart:function(e){const a=e.changedTouches[0].pageX;l.value=a,t.value=Date.now()},touchEnd:function(e){const u=e.changedTouches[0].pageX;s.value=u,Date.now()-t.value>2e3||Math.abs(l.value-s.value)<10||(s.value-l.value>0?a.onScrollRight():a.onScrollLeft())}}})({onScrollLeft:()=>{n.value.gotoNextMonth()},onScrollRight:()=>{n.value.gotoPrevMonth()}}),v=e=>{const{year:a,month:t}=e;o.value=a,c.value=t,I({title:`${a}年${t}月`})};return(e,a)=>{const o=i;return t(),l(o,{class:"wrap",ref:"listComRef",onTouchstart:h(d),onTouchend:h(r)},{default:s((()=>[u(b,{ref_key:"calendarRef",ref:n,onChange:v},null,512)])),_:1},8,["onTouchstart","onTouchend"])}}}),[["__scopeId","data-v-e468690f"]]);export{D as default};
